<div class="stronghold-manager">
    <nav class="sheet-tabs tabs" data-group="main">
        <a class="item active" data-tab="strongholds">
            <i class="fas fa-castle"></i> Strongholds
        </a>
        <a class="item" data-tab="settings">
            <i class="fas fa-cogs"></i> Settings
        </a>
    </nav>

    <div class="tab-content">
        <div class="tab" data-tab="strongholds">
            <div class="stronghold-header">
                <h2>Stronghold Management</h2>
                <button class="create-stronghold" type="button">
                    <i class="fas fa-plus"></i> Create Stronghold
                </button>
            </div>

            <div class="stronghold-list strongholds-app">
                {{#if strongholds}}
                <div class="sh-list-header strongholds-app">
                  <div class="sh-header-grid">
                    <span class="shh-chev"></span>
                    <span class="shh-name">Name</span>
                    <span class="shh-type">Type</span>
                    <span class="shh-class">Class</span>
                    <span class="shh-level">Level</span>
                    <span class="shh-value">Value</span>
                    <span class="shh-status">Status</span>
                    <span class="shh-controls sr-only">Controls</span>
                  </div>
                </div>
                <ul class="sh-list">
                    {{#each strongholds}}
                    <li class="sh-item {{#unless active}}inactive{{/unless}}" data-stronghold-id="{{id}}">
                        <details class="sh-panel">
                            <summary class="sh-summary flexrow">
                                <i class="fas fa-chevron-right sh-chev"></i>
                                <span class="sh-name">{{name}}</span>
                                <span class="sh-type">{{capitalize type}}</span>
                                <span class="sh-class">
                                    {{#if classFlavorDisplay}}{{classFlavorDisplay}}{{else}}
                                        {{#if classFlavor}}{{capitalize classFlavor}}{{else}}â€”{{/if}}
                                    {{/if}}
                                </span>
                                <span class="sh-level">{{level}} / 5</span>
                                <span class="sh-value">{{formatNumber totalValueCost}} gp</span>
                                <span class="sh-status">
                                    {{#if active}}
                                        <span class="party-bonus"><i class="fas fa-check-circle"></i> Active</span>
                                    {{else}}
                                        <span class="class-bonus sh-status--inactive"><i class="fas fa-times-circle"></i> Inactive</span>
                                    {{/if}}
                                </span>
                                <span class="stronghold-controls">
                                    <button class="toggle-stronghold" data-stronghold-id="{{id}}" title="{{#if active}}Deactivate{{else}}Activate{{/if}}">
                                        <i class="fas {{#if active}}fa-eye{{else}}fa-eye-slash{{/if}}"></i>
                                    </button>
                                    <button class="edit-stronghold" data-stronghold-id="{{id}}" title="Edit">
                                        <i class="fas fa-edit"></i>
                                    </button>
                                    <button class="delete-stronghold" data-stronghold-id="{{id}}" title="Delete">
                                        <i class="fas fa-trash"></i>
                                    </button>
                                </span>
                            </summary>

                            <div class="sh-details">
                                {{#if description}}
                                <div class="stronghold-description">
                                    <p><em>{{description}}</em></p>
                                </div>
                                {{/if}}
                                {{#if typeDescription}}
                                <div class="stronghold-type-description">
                                    <p>{{typeDescription}}</p>
                                </div>
                                {{/if}}

                                <div class="stronghold-actions">
                                    {{#if canUpgrade}}
                                    <button class="upgrade-stronghold btn-compact" data-stronghold-id="{{id}}" title="Upgrade stronghold">
                                        <i class="fas fa-arrow-up"></i> Upgrade ({{upgradeCost}} gp)
                                    </button>
                                    {{/if}}
                                    <button class="add-bonus btn-compact" data-stronghold-id="{{id}}" title="Add Custom Bonus">
                                        <i class="fas fa-plus"></i> Add Bonus
                                    </button>
                                </div>

                                <details class="sh-collapsible">
                                    <summary class="sh-collapsible-summary">Custom Bonuses</summary>
                                    <div class="stronghold-bonuses">
                                        {{#if bonuses}}
                                        <ul>
                                            {{#each bonuses}}
                                            <li class="bonus-item">
                                                <div class="bonus-header">
                                                    <strong>{{name}}</strong>
                                                    <button class="remove-bonus" data-stronghold-id="{{../id}}" data-bonus-id="{{id}}" title="Remove bonus">
                                                        <i class="fas fa-times"></i>
                                                    </button>
                                                </div>

                                                <div class="mechanics-summary">
                                                    <div class="collapsible">
                                                        <button class="section-toggle" type="button"><i class="fas fa-chevron-right"></i> Mechanics</button>
                                                        <div class="section-body" style="display: none;">
                                                            {{#if typeSummary}}
                                                            <div class="mechanics-block type-summary">
                                                                <h5>Demesne Effects</h5>
                                                                <ul>
                                                                    {{#each typeSummary.demesne}}
                                                                    <li>{{this}}</li>
                                                                    {{/each}}
                                                                </ul>
                                                                <h5>Stronghold Actions</h5>
                                                                <ul>
                                                                    {{#each typeSummary.actions}}
                                                                    <li>{{this}}</li>
                                                                    {{/each}}
                                                                </ul>
                                                            </div>
                                                            {{/if}}
                                                            {{#if classSummary}}
                                                            <div class="mechanics-block class-summary">
                                                                {{#if classSummary.followers}}
                                                                <h5>Followers</h5>
                                                                <p>{{classSummary.followers}}</p>
                                                                {{/if}}
                                                                {{#if classSummary.actions}}
                                                                <h5>Class Actions</h5>
                                                                <ul>
                                                                    {{#each classSummary.actions}}
                                                                    <li>{{this}}</li>
                                                                    {{/each}}
                                                                </ul>
                                                                {{/if}}
                                                                {{#if classSummary.tables}}
                                                                <h5>Tables</h5>
                                                                <ul>
                                                                    {{#each classSummary.tables}}
                                                                    <li>{{this}}</li>
                                                                    {{/each}}
                                                                </ul>
                                                                {{/if}}
                                                            </div>
                                                            {{/if}}
                                                        </div>
                                                    </div>
                                                </div>

                                                <p>{{description}}</p>
                                                {{#if partyWide}}<em>(Party-wide bonus)</em>{{else}}<em>(Character-specific bonus)</em>{{/if}}
                                            </li>
                                            {{/each}}
                                        </ul>
                                        {{else}}
                                        <p class="no-bonuses">No custom bonuses added yet</p>
                                        {{/if}}
                                    </div>
                                </details>
                            </div>
                        </details>
                    </li>
                    {{/each}}
                </ul>
                {{else}}
                <div class="no-strongholds">
                    <p>No strongholds have been created yet.</p>
                    <p>Click "Create Stronghold" to get started.</p>
                </div>
                {{/if}}
            </div>
        </div>

        <div class="tab" data-tab="settings">
            <div class="settings-content">
                <h2>Module Settings</h2>
                <p>Configure stronghold behavior, pricing, and automation options.</p>

                <div class="setting-row">
                    <label for="autoApplyBonuses">
                        <input type="checkbox" id="autoApplyBonuses" {{#if enableAutoApplyBonuses}}checked{{/if}}>
                        Automatically apply stronghold bonuses during extended rests
                    </label>
                </div>

                <hr>
                <h3>Prices</h3>
                <p><small>GM configurable. Leave fields blank to keep defaults. Values are gp.</small></p>

                <div class="price-table">
                    <div class="price-section">
                        <h4>Building Costs</h4>
                        <div class="grid-2">
                            <label>Temple <input type="number" min="0" step="100" id="price-temple" value="{{prices.building.temple}}"></label>
                            <label>Keep <input type="number" min="0" step="100" id="price-keep" value="{{prices.building.keep}}"></label>
                            <label>Tower <input type="number" min="0" step="100" id="price-tower" value="{{prices.building.tower}}"></label>
                            <label>Establishment <input type="number" min="0" step="100" id="price-establishment" value="{{prices.building.establishment}}"></label>
                        </div>
                    </div>
                    <div class="price-section">
                        <h4>Upgrade Costs</h4>
                        <div class="grid-4">
                            <label>To 2 <input type="number" min="0" step="100" id="price-up-2" value="{{prices.upgrading.2}}"></label>
                            <label>To 3 <input type="number" min="0" step="100" id="price-up-3" value="{{prices.upgrading.3}}"></label>
                            <label>To 4 <input type="number" min="0" step="100" id="price-up-4" value="{{prices.upgrading.4}}"></label>
                            <label>To 5 <input type="number" min="0" step="100" id="price-up-5" value="{{prices.upgrading.5}}"></label>
                        </div>
                    </div>
                    <div class="price-actions">
                        <button type="button" class="btn-compact save-prices"><i class="fas fa-save"></i> Save Prices</button>
                        <button type="button" class="btn-compact reset-prices"><i class="fas fa-undo"></i> Reset to Defaults</button>
                    </div>
                </div>

                <div class="setting-description">
                    <p><em>Prices update new creations and total cost calculations. Existing strongholds retain their stored totalCostPaid unless modified.</em></p>
                </div>
            </div>
        </div>
    </div>
</div>